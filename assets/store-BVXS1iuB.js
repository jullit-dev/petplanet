import"./style-D6kM5oGy.js";const p="https://slender-thundering-marmoset.glitch.me",_=async(t,e={})=>{try{const c=await fetch(`${p}${t}`,e);if(!c.ok)throw new Error(c.status);return await c.json()}catch(c){console.error(`Ошибка запроса ${c}`)}},h=t=>_(`/api/products/category/${t}`),v=t=>_(`/api/products/list/${t.join(",")}`),L=(t,e)=>_("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeId:t,products:e})}),$=t=>{const e=document.createElement("div");e.classList.add("order-message");const c=document.createElement("p");c.classList.add("order-message__text"),c.textContent=`Ваш заказ оформлен, номер ${t}. Вы можете забрать его завтра после 12:00`;const o=document.createElement("button");return o.classList.add("button"),o.classList.add("order-message__close-button"),o.textContent="Закрыть",o.ariaLabel="Закрыть окно с информацие о заказе",e.append(c,o),o.addEventListener("click",()=>{e.remove()}),e},E=({id:t,name:e,price:c,photoUrl:o})=>{const s=document.createElement("li");return s.classList.add("store__item"),s.innerHTML=`
    <article class="store__product product">
      <h3 class="product__title">${e}</h3>
      <p class="product__price">${c}&nbsp;₽</p>
      <img class="product__image" src="${p}${o}"
        alt="${e}" width="388" height="261">
      <button class="button button_purple product__btn-add-cart" data-id="${t}" aria-label="Добавить в корзину">Заказать</button>
    </article>
  `,s},x=(t,e)=>{e.textContent="",t.forEach(c=>{const o=E(c);e.append(o)})},g=(t,e,c)=>{t.textContent="",c.forEach(({id:o,photoUrl:s,name:a,price:n})=>{const u=e.find(C=>C.id===o);if(!u)return;const m=document.createElement("li");m.classList.add("modal__cart-item"),m.innerHTML=`
      <h3 class="modal__cart-item-title">${a}</h3>
      <img class="modal__cart-item-img" src="${p}${s}" alt="${a}">
      <div class="modal__cart-item-count">
        <button class="modal__btn-count modal__minus" data-id="${o}" aria-label="Уменьшить количество на одну единицу">-</button>
        <span class="modal__count">${u.count}</span>
        <button class="modal__btn-count modal__plus" data-id="${o}" aria-label="Увеличить количество на одну единицу">+</button>
      </div>
      <p class="modal__cart-item-price">${n*u.count}&nbsp;₽</p>
    `,t.append(m)})},I=document.querySelector(".store__cart-button"),O=I.querySelector(".store__cart-cnt"),d=document.querySelector(".modal-overlay"),r=document.querySelector(".modal__cart-items");document.querySelector(".modal-overlay__close-button");const f=document.querySelector(".modal__cart-price"),b=document.querySelector(".modal__cart-form"),l=document.querySelector(".modal__cart-button"),S=(t,e)=>t.reduce((c,o)=>{const s=e.find(a=>a.id===o.id);return c+s.price*o.count},0),i=()=>{const t=JSON.parse(localStorage.getItem("cartItems")||"[]"),e=c=>c.reduce((o,s)=>o+s.count,0);O.textContent=e(t)},P=t=>{const e=JSON.parse(localStorage.getItem("cartItems")||"[]"),c=e.find(o=>o.id===t);c?c.count+=1:e.push({id:t,count:1}),localStorage.setItem("cartItems",JSON.stringify(e)),i()},y=(t,e)=>{const c=JSON.parse(localStorage.getItem("cartItems")||"[]"),o=c.findIndex(s=>s.id===t);if(o!==-1){c[o].count+=e,c[o].count<=0&&c.splice(o,1),localStorage.setItem("cartItems",JSON.stringify(c));const s=JSON.parse(localStorage.getItem("cartProductDetails")||"[]");i(),g(r,c,s);const a=S(c,s);f.innerHTML=`${a}&nbsp;₽`}},q=t=>{t.textContent="";const e=document.createElement("li");e.textContent="Корзина пуста",t.append(e),l.disabled="disabled"};r.addEventListener("click",({target:t})=>{if(t.classList.contains("modal__plus")){const e=t.dataset.id;y(e,1)}if(t.classList.contains("modal__minus")){const e=t.dataset.id;y(e,-1),r.textContent||q(r)}});I.addEventListener("click",async()=>{d.style.display="flex",l.disabled&&l.removeAttribute("disabled");const t=JSON.parse(localStorage.getItem("cartItems")||"[]"),e=t.map(s=>s.id);if(!e.length){r.textContent="";const s=document.createElement("li");s.textContent="Корзина пуста",r.append(s),l.disabled="disabled";return}const c=await v(e);localStorage.setItem("cartProductDetails",JSON.stringify(c)),g(r,t,c);const o=S(t,c);f.innerHTML=`${o}&nbsp;₽`});d.addEventListener("click",({target:t})=>{(t===d||t.closest(".modal-overlay__close-button"))&&(d.style.display="none")});b.addEventListener("submit",async t=>{t.preventDefault();const e=b.store.value,o=JSON.parse(localStorage.getItem("cartItems")||"[]").map(({id:a,count:n})=>({id:a,quantity:n})),{orderId:s}=await L(e,o);localStorage.removeItem("cartItems"),localStorage.removeItem("cartProductDetails"),document.body.append($(s)),d.style.display="none",i()});i();const J=()=>{const t=document.querySelectorAll(".store__category-button"),e=document.querySelector(".store__list"),c=async({target:o})=>{const s=o.textContent;t.forEach(n=>{n.classList.remove("store__category-button_active")}),o.classList.add("store__category-button_active");const a=await h(s);x(a,e)};t.forEach(o=>{o.addEventListener("click",c),o.classList.contains("store__category-button_active")&&c({target:o})}),e.addEventListener("click",({target:o})=>{if(o.closest(".product__btn-add-cart")){const s=o.dataset.id;P(s)}})};J();
